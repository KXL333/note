# 01_查询sql如何执行
>[极客时间_Mysql_实战45讲_林晓斌] 学习笔记

## 基本示意图

![](https://yangc91.oss-cn-hongkong.aliyuncs.com/imgs/20191120224727.png)

  * server
    * 连接器
    * 查询缓存
    * 分析器
    * 优化器
    * 执行器
  * 存储引擎： 插件式：InnoDB(5.5+默认)、MyISAM、Memory
    * 数据存储
    * 数据读取

## 连接器
> 建立连接

`mysql -h$ip -P$port -u$user -p` 

用户或密码错误：`Access denied for user`

> 获取权限 

在连接创建时，获取权限，之后该账户权限有所更新，在本连接中不生效，需新建连接

> 连接管理

空闲连接默认`8`小时断开
```
show processlist
```
![](https://yangc91.oss-cn-hongkong.aliyuncs.com/imgs/20191120225936.png)

## 查询缓存
> 查询语句及结果以key-value形式保存在内存中，下次查询命中，则从缓存直接获取结果

> 不推荐，表一旦有数据更新会清除该表所有缓存，命中率极低

> MySQL 8.0 直接删除了此功能

## 分析器
> 词法分析、语法分析

识别sql语句中的错误语法

## 优化器
决定使用哪个索引、表的连接顺序

## 执行器

* 判断是否有表的查询权限
* 调用引擎接口

如无索引：
 1. 读取`第一行`，判断是否符合条件，符合存入结果集
 2. 读取`下一行`，重复相同的判断逻辑，至最后一行
 3. 返回结果集

有索引：
1. 读取`满足条件的第一行`，存入结果集
 2. 读取`满足条件的下一行`，至最后
 3. 返回结果集
